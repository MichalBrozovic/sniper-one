import { Command } from 'commander'
import { packageInfo } from './config.js'

const command = new Command()

command.name(packageInfo.name).description(packageInfo.description).version(packageInfo.version)

command
	.option('-r, --remote <url>', 'URL of the remote Eshop with https:// prefix')
	.option('-w, --watch', 'watch for changes and reload the page', true)
	.option('-bsc, --blankModeScript', 'simulate the blank template.', false)
	.option('-bst, --blankModeStyle', 'simulate the blank template.', false)
	.option('-n, --notify', 'display pop-over notifications in the browser', false)
	.option('-m, --mode <mode>', 'development or production or build mode', 'development')

command
	.command('build')
	.description('Spustí produkční build bez watcheru')
	.action(async () => {
		// Nastavíme přímo environment proměnné, které index.js použije
		process.env.MIRANDA_MODE = 'production'
		process.env.MIRANDA_WATCH = 'false'
		await import('./index.js')
	})

command
	.command('start')
	.description('Spustí vývojový režim s watcherem')
	.action(async () => {
		process.env.MIRANDA_MODE = 'development'
		process.env.MIRANDA_WATCH = 'true'
		await import('./index.js')
	})

export default command
